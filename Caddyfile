http://localhost:8080 {
    log {
        output stdout
        level DEBUG
    }

    handle_path /api/* {
        route {
            # CORS Headers to allow all origins, methods, and common headers
            header Access-Control-Allow-Origin "*"
            header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            header Access-Control-Allow-Headers "Authorization, Content-Type, X-Requested-With, X-CSRF-Token, *" # Added * for broader compatibility
            
            # Handle OPTIONS preflight requests
            @options method OPTIONS
            respond @options 204

            # AI Core Router: Handles routing to AI providers
            ai_core_router {
                provider openrouter {
                    api_base_url "https://openrouter.ai/api/v1"
                }

                # Define known providers and their API base URLs
                provider google {
                    api_base_url "https://generativelanguage.googleapis.com/v1beta"
                    style "google" # Specify the style for Google provider
                }
                
                provider anthropic {
                    api_base_url "https://api.anthropic.com/v1"
                    style "anthropic" # Specify the style for Anthropic provider
                }

                # Define default providers for specific models
                default_provider_for_model "gemini-pro" "google"
                default_provider_for_model "claude-3-opus-20240229" "anthropic"

                # Define the super-default provider
                super_default_provider "openrouter"
            }
        }
    }

    # Health check endpoint
    handle_path /health {
        respond "OK" 200
    }

    # Default handler
    handle {
        respond "Not found" 404
    }
}
